-- [[ KHOAGAY HUB - FRESH SERVER SNIPER ]]

getgenv().Team = "Marines"
getgenv().CheckedServers = getgenv().CheckedServers or {}

repeat task.wait() until game:IsLoaded()

local Player = game.Players.LocalPlayer
local Status

-- 1. UI SNIPER
local function CreateUI()
    local sg = Instance.new("ScreenGui", Player.PlayerGui)
    local frame = Instance.new("Frame", sg)
    frame.Size = UDim2.new(0, 300, 0, 100)
    frame.Position = UDim2.new(0.5, -150, 0.05, 0)
    frame.BackgroundColor3 = Color3.fromRGB(0, 40, 0) -- MÃ u xanh thá»£ sÄƒn
    frame.BorderSizePixel = 2
    frame.BorderColor3 = Color3.fromRGB(0, 255, 0)
    Instance.new("UICorner", frame)

    Status = Instance.new("TextLabel", frame)
    Status.Size = UDim2.new(1, 0, 1, 0)
    Status.Text = "ğŸ“¡ ÄANG SÄ‚N SERVER Má»šI Má»..."; Status.TextColor3 = Color3.fromRGB(0, 255, 0)
    Status.Font = Enum.Font.GothamBold; Status.TextSize = 14; Status.BackgroundTransparency = 1
end

-- 2. THUáº¬T TOÃN TÃŒM SERVER Má»šI (NEWEST SERVERS)
local function NewServerHop()
    local HttpService = game:GetService("HttpService")
    local TeleportService = game:GetService("TeleportService")
    
    -- Láº¥y server theo thá»© tá»± má»›i nháº¥t (Descending thÆ°á»ng lÃ  server má»›i táº¡o)
    local Api = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Desc&limit=100"
    
    local success, result = pcall(function() return HttpService:JSONDecode(game:HttpGet(Api)) end)
    
    if success and result.data then
        for _, s in pairs(result.data) do
            -- TÃ¬m server váº¯ng (dÆ°á»›i 3 ngÆ°á»i) vÃ  chÆ°a check
            if s.playing > 0 and s.playing <= 3 and s.id ~= game.JobId and not getgenv().CheckedServers[s.id] then
                getgenv().CheckedServers[s.id] = true
                Status.Text = "ğŸš€ PHÃT HIá»†N SERVER Má»šI! NHáº¢Y..."
                TeleportService:TeleportToPlaceInstance(game.PlaceId, s.id, Player)
                return
            end
        end
    end
    -- Reset náº¿u Ä‘Ã£ check háº¿t
    getgenv().CheckedServers = {}
    TeleportService:Teleport(game.PlaceId)
end

-- 3. LOGIC QUÃ‰T TRÃI SIÃŠU Tá»C
CreateUI()
task.spawn(function()
    pcall(function() game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("SetTeam", getgenv().Team) end)
    task.wait(1)

    while true do
        local fruit = nil
        -- QuÃ©t nhanh Workspace
        for _, v in pairs(game.Workspace:GetChildren()) do
            if v:IsA("Tool") and (v.Name:find("Fruit") or v:FindFirstChild("Handle")) then
                fruit = v
                break
            end
        end

        if fruit then
            Status.Text = "ğŸ THáº¤Y TRÃI á» SERVER Má»šI: " .. fruit.Name:upper()
            local hrp = Player.Character:WaitForChild("HumanoidRootPart")
            
            repeat
                hrp.CFrame = fruit.Handle.CFrame
                task.wait(0.1)
            until Player.Backpack:FindFirstChild(fruit.Name) or not fruit:IsDescendantOf(game.Workspace)

            local tool = Player.Backpack:FindFirstChild(fruit.Name)
            if tool then
                Player.Character.Humanoid:EquipTool(tool) -- Cáº§m lÃªn tay (Ä‘Ãºng Ã½ nÃ­)
                task.wait(1)
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("StoreFruit", tool.Name, tool) -- Cáº¥t rÆ°Æ¡ng
                task.wait(1)
                NewServerHop()
                break
            end
        else
            -- Náº¿u server má»›i mÃ  khÃ´ng cÃ³ trÃ¡i ngay -> Nháº£y tiáº¿p server khÃ¡c
            Status.Text = "âŒ SERVER Má»šI KHÃ”NG CÃ“ TRÃI. Äá»”I..."
            task.wait(0.5)
            NewServerHop()
            break
        end
        task.wait(1)
    end
end)


