-- [[ KHOAGAY HUB - HOLD TO HOP ]]

getgenv().Team = "Marines" 

repeat task.wait() 
until game:IsLoaded() and game.Players.LocalPlayer and game.Players.LocalPlayer:FindFirstChild("PlayerGui")

local Player = game.Players.LocalPlayer
local Status

-- 1. GIAO DI·ªÜN
local function CreateUI()
    local sg = Instance.new("ScreenGui", Player.PlayerGui)
    local frame = Instance.new("Frame", sg)
    frame.Size = UDim2.new(0, 280, 0, 100)
    frame.Position = UDim2.new(0.5, -140, 0.2, 0)
    frame.BackgroundColor3 = Color3.fromRGB(15, 15, 20)
    frame.BorderSizePixel = 2
    frame.BorderColor3 = Color3.fromRGB(255, 0, 0)
    Instance.new("UICorner", frame)

    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1, 0, 0, 50); title.Text = "üçé KHOAGAY HUB üçé"
    title.TextColor3 = Color3.fromRGB(255, 0, 0); title.Font = Enum.Font.GothamBold
    title.TextSize = 22; title.BackgroundTransparency = 1

    Status = Instance.new("TextLabel", frame)
    Status.Size = UDim2.new(1, 0, 0, 40); Status.Position = UDim2.new(0, 0, 0.55, 0)
    Status.Text = "‚öì ƒêANG CHU·∫®N B·ªä..."; Status.TextColor3 = Color3.fromRGB(0, 255, 255)
    Status.Font = Enum.Font.GothamBold; Status.TextSize = 16; Status.BackgroundTransparency = 1
end

-- 2. H√ÄM NH·∫¢Y SERVER
local function ServerHop()
    Status.Text = "‚ôªÔ∏è ƒêANG NH·∫¢Y SERVER..."
    pcall(function()
        local result = game:HttpGet("https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100")
        local data = game:GetService("HttpService"):JSONDecode(result)
        for _, s in pairs(data.data) do
            if s.playing < s.maxPlayers and s.id ~= game.JobId then
                game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, s.id, Player)
                return
            end
        end
    end)
end

-- 3. V√íNG L·∫∂P CH√çNH
CreateUI()
task.spawn(function()
    -- T·ª± v√†o phe
    pcall(function() game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("SetTeam", getgenv().Team) end)
    repeat task.wait(1) until Player.Team ~= nil
    
    while true do
        local fruitOnGround = nil
        for _, v in pairs(game.Workspace:GetChildren()) do
            if v:IsA("Tool") and (v.Name:find("Fruit") or v:FindFirstChild("Handle")) then
                fruitOnGround = v
                break
            end
        end

        if fruitOnGround then
            Status.Text = "üçé TH·∫§Y TR√ÅI! ƒêANG T·ªöI L·ª§M..."
            local hrp = Player.Character:WaitForChild("HumanoidRootPart")
            
            -- L·∫∑p l·∫°i vi·ªác bay t·ªõi tr√°i cho ƒë·∫øn khi l·ª•m ƒë∆∞·ª£c v√†o Backpack
            repeat
                hrp.CFrame = fruitOnGround.Handle.CFrame
                task.wait(0.5)
            until Player.Backpack:FindFirstChild(fruitOnGround.Name) or not fruitOnGround:IsDescendantOf(game.Workspace)

            -- Khi ƒë√£ c√≥ trong Backpack, b·∫Øt ƒë·∫ßu c·∫ßm l√™n tay
            local tool = Player.Backpack:FindFirstChild(fruitOnGround.Name)
            if tool then
                Status.Text = "üñêÔ∏è ƒêANG C·∫¶M TR√ÅI TR√äN TAY..."
                Player.Character.Humanoid:EquipTool(tool)
                
                -- ƒê·ª£i ƒë·∫øn khi tr√°i th·ª±c s·ª± n·∫±m tr√™n tay (Character)
                local timeout = 0
                repeat 
                    task.wait(0.5) 
                    timeout = timeout + 1
                until Player.Character:FindFirstChild(tool.Name) or timeout > 10
                
                -- C·∫•t v√†o r∆∞∆°ng (Store)
                Status.Text = "üì¶ ƒêANG C·∫§T V√ÄO R∆Ø∆†NG..."
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("StoreFruit", tool.Name, tool)
                task.wait(1)
                
                -- Xong xu√¥i m·ªõi nh·∫£y
                ServerHop()
                break
            end
        else
            -- Kh√¥ng c√≥ tr√°i th√¨ nh·∫£y sau 5s
            for i = 5, 1, -1 do
                Status.Text = "üîç QU√âT TR√ÅI... NH·∫¢Y TRONG: "..i.."s"
                task.wait(1)
            end
            ServerHop()
            break
        end
        task.wait(1)
    end
end)

