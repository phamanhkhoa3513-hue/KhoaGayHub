-- [[ KHOAGAY HUB - HYBRID SNIPER: FRESH & GOLDEN TIME ]]

getgenv().Team = "Marines"
getgenv().Visited = getgenv().Visited or {}

repeat task.wait() until game:IsLoaded()

local Player = game.Players.LocalPlayer
local Status

-- 1. GIAO DIá»†N HYBRID SIÃŠU Cáº¤P
local function CreateUI()
    local sg = Instance.new("ScreenGui", Player.PlayerGui)
    local frame = Instance.new("Frame", sg)
    frame.Size = UDim2.new(0, 320, 0, 110)
    frame.Position = UDim2.new(0.5, -160, 0.05, 0)
    frame.BackgroundColor3 = Color3.fromRGB(10, 0, 30) -- MÃ u tÃ­m thá»£ sÄƒn
    frame.BorderSizePixel = 2
    frame.BorderColor3 = Color3.fromRGB(0, 255, 255)
    Instance.new("UICorner", frame)

    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1, 0, 0, 40); title.Text = "ðŸ”® KHOAGAY HYBRID SNIPER ðŸ”®"
    title.TextColor3 = Color3.fromRGB(0, 255, 255); title.Font = Enum.Font.GothamBold
    title.TextSize = 16; title.BackgroundTransparency = 1

    Status = Instance.new("TextLabel", frame)
    Status.Size = UDim2.new(1, 0, 0, 50); Status.Position = UDim2.new(0, 0, 0.45, 0)
    Status.Text = "ðŸ“¡ ÄANG Lá»ŒC SERVER (FRESH & 60P)..."; Status.TextColor3 = Color3.fromRGB(255, 255, 255)
    Status.Font = Enum.Font.GothamBold; Status.TextSize = 13; Status.BackgroundTransparency = 1
end

-- 2. HÃ€M NHáº¢Y SERVER HYBRID (Lá»ŒC Cáº¢ SERVER Má»šI & SERVER GIá»œ VÃ€NG)
local function HybridHop()
    local HttpService = game:GetService("HttpService")
    local TeleportService = game:GetService("TeleportService")
    
    -- API láº¥y danh sÃ¡ch server
    local Api = "https://games.roblox.com/v1/games/" .. game.PlaceId .. "/servers/Public?sortOrder=Asc&limit=100"
    local success, result = pcall(function() return HttpService:JSONDecode(game:HttpGet(Api)) end)
    
    if success and result.data then
        for _, s in pairs(result.data) do
            -- LOGIC HYBRID:
            -- 1. Server 1 ngÆ°á»i = Server má»›i má»Ÿ (Tá»‰ lá»‡ 90% cÃ³ trÃ¡i náº¿u vá»«a má»c)
            -- 2. Server 2-4 ngÆ°á»i = Server 'Giá» VÃ ng' 45-60p (Tá»‰ lá»‡ 100% Ä‘Ã£ spawn)
            if s.playing >= 1 and s.playing <= 4 and s.id ~= game.JobId and not getgenv().Visited[s.id] then
                getgenv().Visited[s.id] = true
                Status.Text = "ðŸš€ VÃ€O Má»¤C TIÃŠU: " .. s.playing .. " NGÆ¯á»œI (FRESH/GOLDEN)"
                TeleportService:TeleportToPlaceInstance(game.PlaceId, s.id, Player)
                return
            end
        end
    end
    -- Reset danh sÃ¡ch vÃ  nháº£y láº¡i náº¿u háº¿t server thá»a mÃ£n
    getgenv().Visited = {}
    TeleportService:Teleport(game.PlaceId)
end

-- 3. LOGIC QUÃ‰T VÃ€ Lá»¤M (PHáº¢I Cáº¦M TRÃŠN TAY)
CreateUI()
task.spawn(function()
    -- Tá»± chá»n phe
    pcall(function() game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("SetTeam", getgenv().Team) end)
    task.wait(1)

    while true do
        local fruit = nil
        -- QuÃ©t toÃ n bá»™ map ngay khi vÃ o
        for _, v in pairs(game.Workspace:GetChildren()) do
            if v:IsA("Tool") and (v.Name:find("Fruit") or v:FindFirstChild("Handle")) then
                fruit = v
                break
            end
        end

        if fruit then
            Status.Text = "ðŸŽ ÄÃƒ TÃŒM THáº¤Y: " .. fruit.Name:upper()
            Status.TextColor3 = Color3.fromRGB(255, 255, 0)
            local hrp = Player.Character:WaitForChild("HumanoidRootPart")
            
            -- Bay tá»›i lá»¥m
            repeat
                hrp.CFrame = fruit.Handle.CFrame
                task.wait(0.1)
            until Player.Backpack:FindFirstChild(fruit.Name) or not fruit:IsDescendantOf(game.Workspace)

            local tool = Player.Backpack:FindFirstChild(fruit.Name)
            if tool then
                Player.Character.Humanoid:EquipTool(tool) -- Cáº§m lÃªn tay xÃ¡c nháº­n
                task.wait(1)
                Status.Text = "ðŸ“¦ ÄANG Cáº¤T VÃ€O RÆ¯Æ NG..."
                game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("StoreFruit", tool.Name, tool)
                task.wait(1)
                HybridHop()
                break
            end
        else
            -- Náº¿u server khÃ´ng cÃ³ trÃ¡i ngay (khÃ´ng lÃ£ng phÃ­ thá»i gian)
            Status.Text = "âŒ KHÃ”NG CÃ“ TRÃI. ÄANG Äá»”I SERVER..."
            task.wait(0.3)
            HybridHop()
            break
        end
        task.wait(1)
    end
end)
